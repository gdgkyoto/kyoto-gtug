<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" charset="utf-8" src="jquery-1.4.2.js"></script>
	</head>
	<body>
		<script>
			// 参考コード
			// http://src.chromium.org/viewvc/chrome/trunk/src/chrome/common/extensions/docs/examples/howto/contentscript_xhr/

			// 複数の検索エンジンに対して検索を行い、結果を返す。
			// query: 検索クエリ
			// callback: コールバック
			function fetchSearchResult(query, callback) {
				console.log('fetchSearchResult');
				var params = {
					Appid: 'F86569E3A5245BCD131B9E5A90939CFCF65E92CC',
					query: query,
					sources: 'web',
					'web.count': 3
//					'web.offset': 100
				}
				$.ajax({
					type: 'GET',
					url: 'http://api.search.live.net/json.aspx',
					data: params,
					dataType: 'json',
					success: function(response){
						var results = response.SearchResponse.Web.Results;
//						var result = {};
//						result.error = response;
						var result = [
							{
								'engine': 'Google',
								'total': 0,
								'data': []
							},
							{
								'engine': 'Yahoo',
								'total': 0,
								'data': []
							},
							{
								'engine': 'Bing',
								'total': response.SearchResponse.Web.Total,
								'data': [
									{title: results[0].Title, url: results[0].Url},
									{title: results[1].Title, url: results[1].Url},
									{title: results[2].Title, url: results[2].Url}
								]
							}
						];
						callback(result);
					},
					error:function(data){
						callback({error: data});
					}
				})					// 仮実装
			};
			// message passing のハンドラ
			// 引数
			// action: 実行する命令の名前
			//         命令についてはそれぞれの関数を参照
			function onRequest(request, sender, callback) {
				console.log('onRequest');
				if (request.action == 'fetchSearchResult') {
					fetchSearchResult(request.query, callback);
				}
			};
			// onResultをmessage passingのハンドラとして登録
			chrome.extension.onRequest.addListener(onRequest);
		</script>
	</body>
</html>

