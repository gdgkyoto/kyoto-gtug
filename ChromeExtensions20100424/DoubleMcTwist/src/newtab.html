<!doctype html>
<html>
	<head>
		<link rel="stylesheet" href="css/main.css" type="text/css">
		<title>Double Mctwist</title>

		<script src="js/jquery-1.4.1.min.js"></script>
		<script>
			$(function(){
				function swap(){
					var top = $('.preview.top'),
						back = $('.preview:not(.top)');
					top.removeClass('top');
					back.addClass('top');
				}
				
				function nextIndex(){
					var index = $('#timeline').get(0).selectedIndex;
					if (index == -1) {
						index = 0;
					} else {
						index ++;
					}
					return index;
				}
			
				function change(){
					swap();
					
					var top = $('.preview.top'),
						back = $('.preview:not(.top)'),
						selected = $('#timeline option:selected'),
						next = selected.next();
					
					if (!next) {
						next = $('#timeline option:first');
					}
					
					if (!top.attr('src')) {
						top.attr('src', selected.val());
					}
					back.attr('src', next.val());
				}
				
				$('#timeline').change(function(){change();});
				
				(function(){
					$('#timeline').get(0).selectedIndex = nextIndex();
					change();
					
					setTimeout(arguments.callee, 5000);
				})();
			});
		</script>
	</head>
	<body>
		<script>
			document.open();
			document.write(chrome.extension.getBackgroundPage().document.body.innerHTML);
			document.close();
		</script>
	</body>
</html>