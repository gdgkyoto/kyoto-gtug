<!doctype html>
<html>
<head>
<link type="text/css" href="common.css" rel="stylesheet">
<script src="common.js" type="text/javascript"></script>
<script src = 'jquery-1.4.2.js' type = 'text/javascript'></script>

<script type="text/javascript">

    //---------------------------------------------------
    // 接続
    var protocol=(location.protocol=="https:")?"wss":"ws";
    var host=location.host;
    var ws = new WebSocket(protocol+"://"+host+"/ws/");

    // 初期化
    var screenImage ;
    var imageRequestTimer=null;

    // データ受信時の処理
    ws.onmessage = function(m) {
        // 受信データをimgタグに反映
        screenImage.setAttribute("src","data:image/jpg;base64,"+m.data);
    };

    // 切断処理
    $(window).unload(function(){
      ws.close();
    });

	// 画面更新タイマー
    function setImageRequestTimer(milliseconds){
    	if(imageRequestTimer!=null){
    		clearTimeout(imageRequestTimer);
    	}
    	imageRequestTimer=setTimeout(updateImage,milliseconds);
    }

	// 手動の画面更新
    function refresh(){
      ws.send( $('#in').val() );
    }

    // HTMLロード完了時の処理
    $(function(){
        screenImage = document.getElementById("screen");
        setImageRequestTimer(500);
    });

    // 画面更新
    function updateImage(){
        // 画面更新要求
    	ws.send( $('#in').val() );

    	// 500ミリ秒後に再度画面更新
    	setImageRequestTimer(500);
    }

</script>

<title>WebSocketRemote</title>
</head>
<body>
<div id="content">AAA</div>
<div id="hashtag">BBB</div>
<input type="button" onClick="refresh()" value="refresh"/>
<input type="text" id="in" />
<img id="screen" src="gtug210x85.png" />
</body>
</html>