<html>
<head><title></title>
<script type="text/javascript" src="gears_init.js"></script>
<script type="text/javascript">
var geo = google.gears.factory.create('beta.geolocation');

var db = google.gears.factory.create('beta.database');
db.open('database-geo');
createDb();

function updatePosition(position) {
	document.getElementById('location').innerHTML = position.latitude + ',' + position.longitude;
	db.execute('insert into Geo values (?, ?, ?)', [new Date().getTime(), position.latitude, position.longitude]);
}

setInterval('geo.getCurrentPosition(updatePosition)', 5000);

function printPositions(){
	var text = '';
	var date = new Date();
	var rs = db.execute('select Timestamp, Latitude, Longtitude from Geo order by Timestamp desc');

	while (rs.isValidRow()) {
		text += date.setTime(rs.field(0)).toString() + ':' + rs.field(1) + ',' + rs.field(2) + '<br>';
  		rs.next();
	}
	
	rs.close();
	
	document.getElementById('history').innerHTML = text;
}

function createDb(){
	db.execute('create table if not exists Geo' +
	           ' (Timestamp int, Latitude double, Longtitude double)');
}

function clearPositions(){
	db.remove();
	createDb();
}

</script>
</head>
<body>
åªç›ín
<div id="location"></div>
<a href="javascript:;" onclick="printPositions();">à⁄ìÆóöó</a>
<a href="javascript:;" onclick="clearPositions();">ÉNÉäÉA</a>
<div id="history"></div>
</body>
</html>