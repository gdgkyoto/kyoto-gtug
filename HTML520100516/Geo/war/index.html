<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8" >
	<script src="gears_init.js"></script>
	<script src="position.js"></script>
	<script src="distance.js"></script>
	<script src="message.js"></script>
	<script src="http://maps.google.com/maps/api/js?sensor=false" ></script>
<script type="text/javascript">
var previousPosition = null;
var currentPosition = null;
var totalDistance = 0;
var timer;
function initialize() {
	timer = setInterval('getPosition(updatePosition)', 2000);
}

function updatePosition(position){
	previousPosition = currentPosition;
	currentPosition = position;
	document.getElementById('location').innerHTML = "【緯度】" + currentPosition.latitude + '【経度】' + currentPosition.longitude;
	if(previousPosition != null){
		var distance = getDistance(previousPosition.longitude, previousPosition.latitude, currentPosition.longitude, currentPosition.latitude);
		totalDistance += distance;
		document.getElementById('distance').innerHTML = totalDistance + "メートル";
		var message = getMessage(totalDistance);
		document.getElementById('message').innerHTML = message;
	}
	
	googleMap(position);
}

var map = null;
function googleMap(position){
	var mapCenter = new google.maps.LatLng(position.latitude, position.longitude);
	if (map === null) {
		map = new google.maps.Map(document.getElementById('map'), {
			center : mapCenter,
			mapTypeId : google.maps.MapTypeId.ROADMAP,
			zoom : 14
		});
	}
	var time = new Date();
	var title = time.getHours() + ':' +
				time.getMinutes() + ':' +
				time.getSeconds();
	var marker = new google.maps.Marker({
		position : mapCenter,
		title : '現在地',
		map : map
	});
}
</script>
</head>
<body onload="initialize()">
	現在地
	<div id="location"></div>
	<br/>
	現在の歩行距離は<br/>
	<div id="distance"></div>
	です。
	<br/>
	現在のメッセージは<br />
	<div id="message"></div>
	<br />
	<div id="map" style="width : 200px; height : 200px"></div>
</body>
</html>