<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>事務員のいやし</title>
<link rel="stylesheet" type="text/css" href="css/common/import.css" media="all" />
</head>

<body onload="init()">
<div id="content">
<div class="flame">
<p class="flame-image"><img src="images/480/img_flame.png" width="480" height="320" alt=""></p>
<canvas id="example_canvas" width="396" height="297"></canvas>
<div class="navigation">
<p class="back"><img src="images/480/btn_go.png"id="buttom" width="63" height="42" alt="再生する" onclick="showImage()"></p>
<p class="play"><img src="images/480/btn_stop.png"id="buttom" width="63" height="42" alt="再生する" onclick="stop()"></p>
<p class="close"><img src="images/480/btn_close.png" width="32" height="42" alt="閉じる" onClick="window.close();"></p>
<script>
var canvas, ctx, image, fadeTimer, alphaBar;

var alphaMin = 0.0;
var alphaMax = 1.0;

//ページ初期化
function init() {
  canvas = document.getElementById("example_canvas");
  ctx = canvas.getContext("2d");
}

// 画像を生成
function generateImage() {
  var favorite = new Array("http://www.rakuten.ne.jp/gold/hibiyakadan/item-image/tf1074.jpg",
                        "http://www.awa.or.jp/home/tomisakikan/parts/umihotaru01.jpg",
                        "http://www.geocities.jp/kanotuno/oyako.jpg",
                        "http://www.astroarts.jp/special/2006spring/image/spring1.jpg",
                        "http://photo1.ganref.jp/photo/0/db188338d0572f91fbb239f5c7f0da59/thumb5.jpg",
                        "http://www.shirakawa.ne.jp/~kyokai/kankou/map/siki/img/f1.jpg",
                        "7-very-cute-hamsters01.jpg",
                        "7-very-cute-hamsters02.jpg",
                        "7-very-cute-hamsters04.jpg",
                        "7-very-cute-hamsters05.jpg",
                        "7-very-cute-hamsters06.jpg",
                        "7-very-cute-hamsters07.jpg"
                        );
  n = Math.floor(Math.random()*favorite.length);
  return favorite[n];
}

// キャンバスに画像書き出し
function showImage() {
  // 画像読み込み
  image = new Image();
  image.src = generateImage();
  //window.alert(image.src);
  fadeIn();

}
// フェードイン
function fadeIn() {
  // 2000ミリ秒で再描画
  var i = 0;
  fadeTimer = setInterval(function() {
    ctx.globalAlpha = i;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(image, 0, 0);

    //alphaMin += 0.1;
    i += 0.1;
    if (i >= alphaMax) {
      stopAnimation();
      fadeOut();
    }
  //}, 2000);
  }, 200);
}
// フェードアウト
function fadeOut() {

  //stopAnimation();
  //// 2000ミリ秒で再描画
  //fadeTimer = setInterval(function() {
  //  if (ctx.globalAlpha < 0.1) {
  //    ctx.globalAlpha = 0;
  //    stopAnimation();
  //  } else {
  //    ctx.globalAlpha -= 0.1;
  //  }
  //  showImage();
  //  alphaBar.value = ctx.globalAlpha;

  var i = 1;
  fadeTimer = setInterval(function() {
    ctx.globalAlpha = i;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(image, 0, 0);
    //alphaBar.value = ctx.globalAlpha;
    i -= 0.1;
    if (i <= alphaMin) {
      stopAnimation();
      showImage();
    }
  //}, 1000);
  }, 100);
}
//停止
function stopAnimation() {
  if (fadeTimer) {
    clearInterval(fadeTimer);
    fadeTimer = null;
  }
}


function stop() {
  stopAnimation();
  ctx.clearRect(0, 0, canvas.width, canvas.height);
}

//ボタン切り替え
function bun() {
  if (canvas_buttom == true) {
     start();
     canvas_buttom = false; 
     document.getElementById("buttom").src = 'images/480/btn_stop.png';
     } else {
     stop();
     canvas_buttom = true; 
     document.getElementById("buttom").src = 'images/480/btn_go.png';
     }
}

</script>
<!-- .navigation // --></div>
<!-- .flame // --></div>
<!-- #content // --></div>
</body>
</html> 
