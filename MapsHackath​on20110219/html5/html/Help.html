


<html>
<head>
<title>Help!</title>
<script src="http://www.google.com/jsapi"></script>
<script>
google.load("maps", "3", {"other_params":"sensor=true"});
google.load("jquery", "1.5");
</script>
<script type="text/javascript">
	$(document).ready(function() {
		//alert("hello");
	});

	
	function buttonPressed() {
		kx.getCurrentLatLng(
			function(latLng){
				var msg = $("#message").attr("value");
				$.post('http://www.smkw.jp/savetheworld/api/help',
					{message:msg, lat:latLng.lat(), lng:latLng.lng()},
					function (data, textStatus) {
						alert("Please wait a minute!");
					}
				);
			}
		);
	}
//ここからkwixilvr:くいっくしるばー
var kx = {};
kx.getDummyPos = function(){
    return {
        coords: {
            latitude: 34.9 + Math.random()
            , longitude: 134.9 + Math.random()
        }
    };
};
kx.pos2LatLng = function(pos){
    return new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
};
kx.getCurrentLatLng = function(callback){// callbackには引数としてgoogle.maps.LatLngオブジェクトが渡される
    if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(
            function(pos){
                callback(kx.pos2LatLng(pos));
            }
            , function(error){
                callback(kx.pos2LatLng(kx.getDummyPos()));
            }
            , {
                enableHighAccuracy: false
                // 5秒以内に取得できなかったらエラー
                , timeout: 5000
                // 1分以内に取得した位置情報のみ使用する
                , maximumAge: 60 * 1000
            }
        );
    }
    else{
        alert("Geolocation API disabled");
    }
};
//"lat":34.9,"lng":134.9,"message":"Help!","id":83,"date":1298097618049
kx.displayRoute = function(data){
    kx.getCurrentLatLng(function(currentLatLng){
        calcRoute(currentLatLng, new google.maps.LatLng(data.lat, data.lng));
    })
}
//ここまでkwixilvr
</script>
</head>
<body>
<div>
Press this button in an emergency.
<form action="help" method="post">
<div id="help-button" style="height:300px;">
<img alt="button" src="http://www.smkw.jp/savetheworld/images/button.png" onclick="buttonPressed();">
</div>
<div>
<input id="message" type="text" name="message" value="Help!">
<input id="lat" type="hidden" name="lat" value="35" />
<input id="lng" type="hidden" name="lng" value="135" />
</div>
</form>
</div>
</body>
</html>